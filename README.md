# Install
You need [Node.js](https://nodejs.org) installed on your machine. Simply download the installer from [nodejs.org](https://nodejs.org) and go through the installation steps.

Once Node.js is installed, open your command prompt or terminal and run `sudo npm i -g gatsby-cli`. This installs [Gatsby](https://www.gatsbyjs.org/) command line tools.

This project uses the [yarn](https://classic.yarnpkg.com/en/docs/install/) package manager. Please install it.

 ---
# Development Build
The development build is unoptimized and ideal for testing new features and hunting down bugs. The server tracks file changes and forces a refresh in the browser when a change has been detected.

To run the development mode run:
<br/>`npm run develop`


Visit [localhost:8000](http://localhost:8000) to see the running application.
You can also go to [localhost:8000/___graphql](http://localhost:8000/___graphql) to query the data using the __graphql interface



# Production Build
The production build, compacts the files and bundles them for speed. Use this mode for deploying the application. 

To run the production database and server run:
<br/>`npm run build`
<br/>`npm run start`


Visit [localhost:9000](http://localhost:9000) to see the running application.

# Development

## Folder Structure

Most app specific code lies in the *./src* directory. Story flavor text and logic sits in the *./story* directory. The *./public* and *./cache* are auto generated by Gatsby 
and can might need to be cleared between builds if you encounter unexpected errors.

*./src/components*<br>
Contains [React Components](https://reactjs.org/docs/components-and-props.html), typical of any react app.

*./src/css*<br>
Contains all the CSS styling for the game. The core of the styling is based off of [Bootsrap 4.5](https://getbootstrap.com/docs/4.5/getting-started/introduction/).

*./src/images/*<br>
Images in this folder are automatically processed by Gatsby and loaded into [GraphQL](https://www.gatsbyjs.org/docs/graphql/).

*./src/pages/*<br>
All JSX files in this folder are automatically proccessed as pages by [Gatsby](https://www.gatsbyjs.org/docs/recipes/pages-layout).
They are then accessible by url.

*./src/state/*<br>
This is where the [Redux](https://react-redux.js.org/) actions and reducers reside. All application wide state changes
are handled via Redux.


*./story/events*<br>
On build, events are automatically pulled from this folder by Gatsby and loaded into [GraphQL](https://www.gatsbyjs.org/docs/graphql/).  The files are transformed into an Abstract Syntax Tree by *gatsby-transformer-remark*. At run time active events are sent to the two-pass transpiler along with the application state to generate a React Component plus JSON metadata such as available choices, prompts, etc... that are propagated through the game controls.

*./story/stats*<br>
Provides meta data on all the stats in the game.

*./plugins/gatsby-markdown-storybook*<br>
Contains code for a two pass transpiler that transforms MardownStorybook, 
an extension to markdown that is described bellow, into HTML + Javscript.

## Making New Events
Events are stored in the *./story/events/* folder and are coded in an extended form of markdown, we call **MarkdownStorybook (mds)**.
This supports all the [usual syntax of markdown](https://www.markdownguide.org/basic-syntax/) including HTML. 

We extend markdown functionality with some additional tags:

- &lt;**Mod** *stat value*&gt;&lt;/**Mod**&gt; <br>
Modifies a specified game statistic relative to existing value
    - *stat*: The path of the stat to modify 
    - *value*: amount to increase/decrease the stat.

- &lt;**Set** *stat value*&gt;&lt;/**Set**&gt; <br>
Sets a specified statistic to set value
    - *name, gender, money, morale*: do not need an argument, just the property
    - *stat*: The path to the stat to modify 
    - *value*: to set stat to.
     
- &lt;**Prompt** *text* &gt;&lt;/**Prompt**&gt; <br>
Displays text in the user controls. 
    - *text*: What will be shown to the user in the controls. 
    - Note: The last usage of the tag is the only one shown to the user

- &lt;**Next** *event* &gt;&lt;/**Prompt**&gt; <br>
Sets the next event that will procceed this one.
    - *event*: Filename of next event
    - Note: The last usage of the tag is the only one shown to the user
    

- &lt;**Check** *stat value* &gt;*body*&lt;/**Check**&gt; <br>
Passive statistic check, used for rendering event
    - *stat*: The stat to check. 
    - *value*: minimum value 
    - *body* if check passes the body is evaluated, otherwise body is skipped
    

- &lt;**Choice** *label [stat value]* &gt;*body*&lt;/**Choice**&gt; <br>
Displays a story choice in the user controls. Body of the choice is only evaluated on click.
    - *title*: Label associated with choice, placed on buttons
    - *body*: Everything in the body will be evaluated and shown when the choice is selected <br>
    If you want a roll the dice skill check
    - *stat*: The stat to check.
    - *value*: Minimum value 
        
- &lt;**Else**&gt;*body*&lt;/**Else**&gt; <br>
Evaluated on failing to pass check on branching statments such as **Check** and **Choice**
    - *body*: Evaluated on failure to pass check
    